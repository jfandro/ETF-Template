
@{
    ViewBag.Title = "Dashboard";
}
<link href="~/Content/mydataviz.css" rel="stylesheet" />
<style>
    .container-question {
        color: #000;
    }
</style>

@section header {
    <section class="jumbotron section-header header-image" style="background-image:url('https://www.letelegramme.fr/images/2019/03/25/oceans-un-bien-commun-de-l-humanite-a-defendre-a-l-onu_4484351_540x271p.jpg')">
        <div class="container">
            <h1 class="text-center">Mes allocations modèle</h1>
            <p class="lead text-center">Vitrine d'expert</p>
        </div>
    </section>
}

<section class="section-b">
    <div class="container">
        <p>
            La mission de cette page est de présenter les portefeuilles modèles dont vous êtes le titulaire.
            Votre vitrine en matière d'allocations.
            On a choisi 2 formats de présentation mais libre à vous et votre imagination d'en créer une qui vous soit plus juste?
            La 1ère présentation choisie est celle d'un graphique à bulles où chaque élément représente un portefeuille modèle,
            sa position étant liée à sa performance et sa volatilité constatée sur une période passée que nous avons normalisé
            mais que l'on aurait pu laisser libre. La couleur et la taille des bulles n'ont ici aucune fonction.
        </p>
    </div>
</section>

<section class="section-e">
    <div class="container">
        <div class="text-center">
            <p class="btn-group btn-group-xs" data-toggle="buttons">
                <label class="btn btn-primary btn-option hidden-xs" data-option="1W" data-toggle="tooltip" title="Depuis une semaine"><input type="radio" name="options">1W</label>
                <label class="btn btn-primary btn-option active" data-option="1M" data-toggle="tooltip" title="Depuis un mois"><input type="radio" name="options">1M</label>
                <label class="btn btn-primary btn-option" data-option="3M" data-toggle="tooltip" title="Depuis 3 mois"><input type="radio" name="options">3M</label>
                <label class="btn btn-primary btn-option" data-option="YTD" data-toggle="tooltip" title="Depuis le 1er janvier"><input type="radio" name="options">YTD</label>
                <label class="btn btn-primary btn-option" data-option="1Y" data-toggle="tooltip" title="Depuis 1 an"><input type="radio" name="options">1Y</label>
                <label class="btn btn-primary btn-option hidden-xs" data-option="@(DateTime.Today.Year-1)" data-toggle="tooltip" title="@(DateTime.Today.Year-1)"><input type="radio" name="options">@(DateTime.Today.Year - 1)</label>
            </p>
        </div>
        <div class="row">
            <div id="portfolios-bubbles" class="col-lg-12 well">
                <div id="bubbles" class="bubble-chart" style="height:500px;"></div>
            </div>
        </div>
        <div id="portfolios-table" class="table-responsive small text-nowrap">
        </div>
    </div>
</section>

<section class="container">
    <h2>Implémentation</h2>
    <p>
        Pour obtenir ce graphique à bulles couvrant tous
        vos portefeuilles modèle dans un unique espace performances/risques,
        déclarez les 2 scripts suivants: <ul>
            <li>Le premier est accessible sur le serveur et contient tous le code open source sur la restitution dataviz;</li>
            <li>Le second est en charge de votre authetification et de la collecte des données pour le chargement des graphiques; </li>
        </ul>,
        Il est personnalisable en fonction de vos besoins et de voir.
    </p>
    <pre class="prettyprint">
    <xmp>
    <!-- Latest version of dataviz -->
    <script src="https://lili.am/bundles/dataviz"></script>
    <!-- Latest version of controllers -->
    <script src="https://workshop.lili.am/bundles/controllers"></script>
        </xmp>
    </pre>
    <p>Une fois ces scripts déclarés et l'authentification faite, 
    <b>pour charger tous les graphiques de la page</b>, nous allons procéder comme ci-dessous:</p>
    <pre class="prettyprint">
    <xmp>
    <script>
        // First, we create a new instance of portfolios controller to get data from the server
        $p = new LoyolApp.PortfolioController();
        // Then we call the action named UserPortfoliosKpis to get the kpis of all user portfolios (option is 1Y 3Y ...)
        $p.get('UserPortfoliosKpis', { option: option }, function (data) {
            // Then we call the function loadGrid describeb below to populate the grid
            loadGrid(data);
        });
    </script>
    </xmp>
    </pre>

</section>

<section class="section-b">
    <div class="container">
        <h2>Mosaique</h2>
        <div id="myportfolios" class="row"></div>
    </div>
</section>

<section class="container">
    <h2>Implémentation</h2>
    <p>
        La construction de la mosaïque ci-dessus repose sur la même source de données (API) utilisée pour le graphique à bulles précédent. Une fois effective
        la récupération des données, il suffit ensuite de parourir les données du portefeuille et celle des statistiques rattachées.
        Vous trouverez pele mêle les rendements, volatilités et autres indicateurs de risques.
    </p>
    <pre class="prettyprint">
    <xmp>
    <script>

        // This function create a custom grid of tiles,
        // one tile by portfolio displaying name, yield and standard deviation(risk)
        var loadGrid = function (data) {
            var $cx = $('#myportfolios')
            $.each(data, function (i, p) {
                var url = "url('" + p.ImageUrl + "')";
                var $cd = $('<div>').addClass('card card-img col-sm-3').attr('style', "background-image:" + url);
                var $bd = $('<div>').addClass('card-body');
                var $tt = $('<h3>').html(p.Name);
                var $rt = $('<p>').html('Perf = ' + parseFloat(100 * p.Stats.Yield).toFixed(2) + '%');
                var $st = $('<p>').html('Vola = ' + parseFloat(100 * p.Stats.StdDev).toFixed(2) + '%');
                $bd.append($tt, $rt, $st);
                $cd.append($bd);
                $cx.append($cd);
            });
</script>
        </xmp>
    </pre>

</section>


@section scripts {

    <!-- Latest version of dataviz codes -->
    <script src="https://lili.am/bundles/dataviz"></script>
    <!-- Your script to create and load bubbles -->
    <script src="~/Scripts/board-1.0.js"></script>

}
